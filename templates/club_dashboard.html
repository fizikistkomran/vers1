{% extends "base.html" %}
{% block title %}{{ club.name }} · Kulüp Paneli{% endblock %}
{% block content %}

<div class="hero card" style="position:relative;border-radius:16px;overflow:hidden;border:1px solid var(--glass-stroke)">
  <div style="height:180px;background:#222 url('{{ club.banner_url or "" }}') center/cover no-repeat"></div>
  <div style="padding:16px">
    <h2 style="margin:0">{{ club.name }}</h2>
    <div class="meta sub">Kulüp #{{ club.id }}</div>
  </div>
</div>

<div class="tabs" style="display:flex;gap:16px;flex-wrap:wrap;margin:16px 0">
  <a class="chip" href="{{ url_for('club_members', club_id=club.id) }}">Üyeler & Roller</a>
  <a class="chip" href="{{ url_for('club_analytics', club_id=club.id) }}">Analitik</a>
  <a class="chip" href="{{ url_for('club_graph', club_id=club.id) }}">Grafik (tam ekran)</a>
</div>

{% if owner %}
  <h3 class="section-title">Topluluk Ağı</h3>
  <p class="muted">Bağ oluşturmak için kulüp panelinden “Tanıyorum” gönder, gelen istekleri kabul et. Tam ekran için üstteki bağlantıyı kullan.</p>
  <iframe
    src="{{ url_for('club_graph', club_id=club.id) }}"
    style="width:100%; height:400px; border:1px solid var(--glass-stroke); border-radius:12px; margin-bottom:20px"
    frameborder="0"
    allowfullscreen
  ></iframe>
{% endif %}

<h3 class="section-title" style="margin-top:20px">Kulüp Üyeleri</h3>
<table class="list" style="width:100%;border-collapse:collapse">
  <thead>
    <tr>
      <th style="text-align:left;padding:8px 6px">Üye</th>
      <th style="text-align:left;padding:8px 6px">Rol</th>
      <th style="text-align:left;padding:8px 6px">İşlem</th>
    </tr>
  </thead>
  <tbody>
    {% for m in members %}
    <tr>
      <td style="padding:8px 6px;display:flex;gap:8px;align-items:center">
        <a href="{{ url_for('profile', uid=m.user_id) }}" style="display:flex;align-items:center;gap:8px;color:inherit;text-decoration:none;">
          <img src="{{ m.avatar_url or '/static/avatar-placeholder.png' }}" alt="{{ m.name }}" style="width:28px;height:28px;border-radius:50%;object-fit:cover;border:1px solid #333">
          {{ m.name }}
        </a>
      </td>
      <td style="padding:8px 6px"><code>{{ m.role }}</code></td>
      <td style="padding:8px 6px">
        {% if m.user_id != user_id %}
          {% if m.connection_status == 'none' %}
            <form method="post" action="{{ url_for('connect_request', uid=m.user_id) }}">
              <button type="submit" class="btn-badge">Bağlan</button>
            </form>
          {% elif m.connection_status == 'pending_sent' %}
            <span class="pill">İstek gönderildi</span>
          {% elif m.connection_status == 'pending_received' %}
            <span class="pill pill blue">İstek var</span>
          {% elif m.connection_status == 'connected' %}
            <span class="pill pill green">Bağlı</span>
          {% endif %}
        {% else %}
          <span class="pill pill purple">Siz</span>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

{% if events %}
  <h3 class="section-title" style="margin-top:20px">Etkinlikler</h3>
  <div class="grid">
    {% for e in events %}
      <a class="card" href="{{ url_for('event_analytics', event_id=e.id) }}">
        <div style="font-size:20px">{{ e.title }}</div>
        <div class="meta">{{ e.starts_at|ts }}</div>
        <div class="meta">{{ e.category }}</div>
      </a>
    {% endfor %}
  </div>
{% endif %}

{% endblock %}
