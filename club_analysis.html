{% extends "base.html" %}
{% block title %}{{ club.name }} Kulüp Analizi · enfekte.co{% endblock %}
{% block content %}

<h2 class="section-title">{{ club.name }} Kulüp Analizi</h2>

<div class="list" style="margin-bottom:16px">
  <div class="row"><div>Toplam etkinlik</div><div class="pill">{{ total_events }}</div></div>
  <div class="row"><div>Toplam check-in</div><div class="pill">{{ total_checkins }}</div></div>
  <div class="row"><div>Benzersiz katılımcı</div><div class="pill">{{ unique_attendees }}</div></div>
  <div class="row"><div>Tekrarlayan katılımcı</div><div class="pill">{{ repeaters }}</div></div>
  {# avg_retention backend’den gelmiyor; varsa formatla, yoksa '-' göster #}
  <div class="row">
    <div>Ortalama ardışık etkinlik tutma</div>
    <div class="pill">
      {% if avg_retention is defined and avg_retention is not none %}
        {{ '%.1f'|format(avg_retention) }}%
      {% else %}
        -
      {% endif %}
    </div>
  </div>
</div>

<h2 class="section-title">Etkinlik/Toplantı Trend</h2>
{# backend şu anda 'events' listesini gönderiyor; onu kullan #}
{% if events and events|length > 0 %}
  <div class="list">
    {% for e in events %}
      <div class="row">
        <div style="min-width:120px" class="pill">{{ (e.tkey)|ts }}</div>
        <div style="flex:1">
          {{ e.title }}
          {% if (e.category or 'event') == 'meeting' %}
            <span class="pill">Toplantı</span>
          {% endif %}
        </div>
        <div class="pill">{{ e.checkin_count }} kişi</div>
        <a class="link" href="{{ url_for('event_analytics', event_id=e.id) }}">analiz</a>
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="empty list">Veri yok.</div>
{% endif %}

{# aşağıdaki iki bölüm opsiyonel—yalnızca backend bu verileri sağlarsa göster #}
{% if top_participants is defined %}
  <h2 class="section-title">En aktif katılımcılar</h2>
  {% if top_participants %}
    <div class="list">
      {% for p in top_participants %}
        <div class="row">
          {% if p.avatar_url %}
            <img class="avatar" src="{{ p.avatar_url }}" alt="{{ p.name }}" style="width:32px;height:32px"/>
          {% else %}
            <span class="avatar" aria-hidden="true"></span>
          {% endif %}
          <div style="flex:1">{{ p.name }}</div>
          <div class="pill">{{ p.count }} katılım</div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="empty list">Veri yok.</div>
  {% endif %}
{% endif %}

{% if top_connectors is defined %}
  <h2 class="section-title">En bağlayıcı üyeler</h2>
  {% if top_connectors %}
    <div class="list">
      {% for c in top_connectors %}
        <div class="row">
          {% if c.avatar_url %}
            <img class="avatar" src="{{ c.avatar_url }}" alt="{{ c.name }}" style="width:32px;height:32px"/>
          {% else %}
            <span class="avatar" aria-hidden="true"></span>
          {% endif %}
          <div style="flex:1">{{ c.name }}</div>
          <div class="pill">{{ c.degree }} bağlantı</div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="empty list">Veri yok.</div>
  {% endif %}
{% endif %}

{% endblock %}

